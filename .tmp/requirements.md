# 要件定義書 - リアルタイムコメント投稿アプリケーション「Commentia」

## 1. 目的

Web会議、講演会、スピーチ等のイベントにおいて、主催者と聴衆者間のインタラクティブなコミュニケーションを実現するリアルタイムコメント投稿アプリケーションを開発する。聴衆者が気軽にコメントを投稿し、相互に反応できる環境を提供することで、イベントの参加感と満足度を向上させる。

## 2. 機能要件

### 2.1 必須機能

#### ルーム管理機能
- [ ] 主催者がワンクリックでルームを作成できる
- [ ] ルーム作成時に自動的にユニークなルームIDが生成される
- [ ] ルームURLを生成し、共有可能にする
- [ ] QRコードを自動生成し、表示・ダウンロード可能にする
- [ ] ルーム番号（短縮コード）での参加を可能にする

#### 参加者管理機能
- [ ] 聴衆者がニックネームのみでルームに参加できる（認証不要）
- [ ] 重複しないニックネームの検証
- [ ] 参加者数のリアルタイム表示
- [ ] 参加者の接続状態管理

#### コメント投稿機能
- [ ] テキストコメントの投稿（最大文字数制限付き）
- [ ] リアルタイムでのコメント配信（WebSocket/Server-Sent Events）
- [ ] コメント投稿時のタイムスタンプ記録
- [ ] 投稿者名の表示
- [ ] コメントの削除機能（投稿者本人のみ）

#### コメント表示機能
- [ ] 新着順でのコメント表示（デフォルト）
- [ ] いいね数順でのコメント表示
- [ ] コメントの自動更新（リアルタイム）

#### リアクション機能
- [ ] コメントへの「いいね」機能
- [ ] いいね数のリアルタイム更新
- [ ] 同一ユーザーの重複いいね防止

#### 制限機能
- [ ] ユーザーごとの投稿数制限（主催者が設定可能）
- [ ] ユーザーごとのいいね数制限（主催者が設定可能）
- [ ] スパム防止のための連続投稿制限

## 3. 非機能要件

### 3.1 パフォーマンス

- WebSocketまたはSSEによるリアルタイム通信で遅延1秒以内
- 同時接続数：目標100人以上
- コメント投稿から表示まで2秒以内
- ページロード時間3秒以内
- API応答時間：95パーセンタイルで500ms以内

### 3.2 セキュリティ

- XSS対策：全ての入力値のサニタイゼーション
- CSRF対策の実装
- SQLインジェクション対策（プリペアドステートメント使用）
- レート制限によるDDoS攻撃対策
- HTTPSによる通信の暗号化
- IPアドレスベースの一時的なアクセス制限

### 3.3 保守性

- TypeScriptによる型安全性の確保
- モジュール化された設計
- 単体テストカバレッジ80%以上
- E2Eテストの実装
- CI/CDパイプラインの構築
- ログ収集とモニタリング（CloudWatch）
- エラートラッキング
- ドキュメンテーションの整備

### 3.4 互換性

- モダンブラウザ対応（Chrome、Edge最新バージョン）
- モバイルデバイス対応（レスポンシブデザイン）
- タブレット対応
- ネットワーク切断時の再接続処理
- オフライン時の適切なエラーハンドリング

## 4. 制約事項

### 4.1 技術的制約

- フロントエンド：React + TypeScript（SPA）
- バックエンド：AWS Lambda + TypeScript（Node.js）
- データベース：Amazon DynamoDB
- インフラ：AWS CDK v2 + TypeScript
- ホスティング：S3 + CloudFront
- API：API Gateway（REST/WebSocket）
- リポジトリ：モノレポ構成（npm workspaces）
- バージョン管理：GitHub
- テスト：Jest（単体テスト）、LocalStack（統合テスト）
- コードフォーマッター：Biome
- ビルドツール：Vite（フロントエンド）、esbuild（Lambda）

## 5. 成功基準

### 5.1 完了の定義

- [ ] 全ての必須機能が実装されている
- [ ] Biomeによるコードフォーマットが全ファイルに適用されている
- [ ] ロジック部分の単体テストが実装され、カバレッジ80%以上
- [ ] LocalStackでのシステムテストが全機能で成功
- [ ] レスポンシブデザインが実装されている
- [ ] エラーハンドリングが適切に実装されている
- [ ] ドキュメント（README、API仕様書）が完成している
- [ ] CI/CDパイプラインが構築されている

### 5.2 受け入れテスト

- 100人同時接続でのストレステスト成功
- 主催者がルームを作成し、聴衆者が参加できる
- コメント投稿が1秒以内に他の参加者に表示される
- いいね機能が正常に動作する
- 制限機能（投稿数、いいね数）が適切に動作する
- モバイルデバイスでの操作性確認
- 異常系テストシナリオの成功

## 6. 想定されるリスク

## 7. 今後の検討事項

### 設計フェーズで詳細化すべき事項
- DynamoDBのテーブル設計（パーティションキー、ソートキー）
- WebSocket vs Server-Sent Eventsの選択
- 状態管理の方針（Redux、Zustand、Context API）
- コンポーネント設計とディレクトリ構造
- APIエンドポイント設計とエラーコード体系
- 認証なしでのセッション管理方法
- データ保持期間とアーカイブポリシー
