# タスクリスト - リアルタイムコメント投稿アプリケーション「Commentia」

## 概要

- 総タスク数: 48
- 推定作業時間: 120-150時間（約3-4週間）
- 優先度: 高

## タスク一覧

### Phase 1: プロジェクト基盤設定

#### Task 1.1: モノレポ構造の初期化

- [x] ルートディレクトリでnpm workspaces設定
- [x] packages/frontend, packages/backend, packages/infrastructure, packages/sharedディレクトリ作成
- [x] 各パッケージのpackage.json初期化
- [x] TypeScript設定ファイル（tsconfig.json）の配置
- **完了条件**: npm workspacesが動作し、各パッケージが認識される
- **依存**: なし
- **推定時間**: 2時間

#### Task 1.2: 開発環境ツールの設定

- [x] Biome設定ファイル（biome.json）作成
- [x] Git hooks設定（pre-commit, pre-push）
- [x] VSCode設定ファイル配置
- [x] 環境変数管理（.env.example）
- **完了条件**: コードフォーマット・リントが自動実行される
- **依存**: Task 1.1
- **推定時間**: 1.5時間

#### Task 1.3: 共通型定義の作成

- [ ] packages/shared/src/types/配下に型定義ファイル作成
- [ ] Room, Comment, User, WebSocketMessage型の定義
- [ ] API Request/Response型の定義
- [ ] DynamoDB Item型の定義
- **完了条件**: 全ての共通型が定義され、エクスポートされる
- **依存**: Task 1.1
- **推定時間**: 3時間

### Phase 2: インフラストラクチャ基盤

#### Task 2.1: CDK基盤セットアップ

- [ ] AWS CDK v2プロジェクトの初期化
- [ ] スタック構成の設計実装（frontend, api, database, websocket）
- [ ] 環境別設定管理（dev/staging/prod）
- [ ] CDK構成要素の基本クラス作成
- **完了条件**: cdk synthが成功し、基本構造が生成される
- **依存**: Task 1.1
- **推定時間**: 4時間

#### Task 2.2: DynamoDBテーブル定義

- [ ] Rooms, Comments, Connections, Likesテーブル定義
- [ ] GSI設定（LikeCountIndex, RoomConnectionsIndex, UserLikesIndex）
- [ ] TTL設定（自動削除機能）
- [ ] オンデマンドキャパシティ設定
- **完了条件**: LocalStackでテーブル作成・操作が可能
- **依存**: Task 2.1
- **推定時間**: 3時間

#### Task 2.3: API Gateway設定

- [ ] REST APIゲートウェイの設定
- [ ] CORS設定
- [ ] レート制限・スロットリング設定
- [ ] エラーレスポンス設定
- **完了条件**: API Gatewayエンドポイントにアクセス可能
- **依存**: Task 2.1
- **推定時間**: 2時間

#### Task 2.4: WebSocket API設定

- [ ] WebSocket APIゲートウェイの設定
- [ ] $connect, $disconnect, joinRoom, leaveRoomルート設定
- [ ] 接続管理の設定
- **完了条件**: WebSocket接続・切断が正常に動作
- **依存**: Task 2.1, Task 2.2
- **推定時間**: 3時間

### Phase 3: バックエンドコアサービス

#### Task 3.1: Lambda関数基盤の実装

- [ ] Lambda関数共通設定（esbuild, ハンドラー構造）
- [ ] AWS SDK v3 クライアント設定
- [ ] エラーハンドリング共通関数
- [ ] ログ出力設定（構造化JSON）
- **完了条件**: Hello World Lambda関数がデプロイ・実行可能
- **依存**: Task 2.1
- **推定時間**: 2時間

#### Task 3.2: Room Service Lambda実装

- [ ] createRoom関数実装（ルーム作成）
- [ ] getRoom関数実装（ルーム情報取得）
- [ ] closeRoom関数実装（ルーム終了）
- [ ] generateRoomCode関数実装（6桁コード生成）
- [ ] roomCode検索機能実装
- **完了条件**: 全てのRoom API が動作し、LocalStackでテスト成功
- **依存**: Task 3.1, Task 2.2
- **推定時間**: 6時間

#### Task 3.3: Comment Service Lambda実装

- [ ] postComment関数実装（コメント投稿）
- [ ] getComments関数実装（コメント一覧取得、ソート対応）
- [ ] deleteComment関数実装（コメント削除）
- [ ] バリデーション機能（文字数制限、XSS対策）
- [ ] 投稿制限機能（連続投稿、最大数制限）
- **完了条件**: Comment API が全て動作し、リアルタイム配信が可能
- **依存**: Task 3.1, Task 2.2, Task 2.4
- **推定時間**: 8時間

#### Task 3.4: Like Service Lambda実装

- [ ] addLike関数実装（いいね追加）
- [ ] removeLike関数実装（いいね取消）
- [ ] 重複いいね防止機能
- [ ] いいね数制限機能
- [ ] いいね数リアルタイム更新
- **完了条件**: Like API が動作し、リアルタイム更新される
- **依存**: Task 3.1, Task 2.2, Task 2.4
- **推定時間**: 4時間

#### Task 3.5: WebSocket Handler実装

- [ ] 接続・切断ハンドラー実装
- [ ] joinRoom/leaveRoomハンドラー実装
- [ ] ブロードキャスト機能実装
- [ ] 接続状態管理
- [ ] エラーハンドリング
- **完了条件**: WebSocket通信が安定し、複数クライアント対応可能
- **依存**: Task 3.1, Task 2.2, Task 2.4
- **推定時間**: 6時間

#### Task 3.6: QR Service Lambda実装

- [ ] QRコード生成ライブラリ統合
- [ ] QRコード生成API実装
- [ ] 画像形式対応（PNG、SVG）
- [ ] キャッシュ機能実装
- **完了条件**: QRコードが正しく生成され、ルーム参加が可能
- **依存**: Task 3.1
- **推定時間**: 2時間

### Phase 4: フロントエンド基盤

#### Task 4.1: React アプリケーション初期化

- [ ] Vite + React + TypeScript プロジェクト作成
- [ ] Tailwind CSS設定
- [ ] 基本レイアウト・ルーティング設定
- [ ] 環境変数管理設定
- **完了条件**: React アプリが正常に起動し、基本画面が表示される
- **依存**: Task 1.1
- **推定時間**: 3時間

#### Task 4.2: 状態管理・API層の実装

- [ ] Zustand ストア設定（room, comments, user, websocket）
- [ ] TanStack Query設定
- [ ] API サービスクラス実装（axios設定）
- [ ] WebSocket接続管理クラス実装
- **完了条件**: 状態管理とAPI通信の基盤が動作
- **依存**: Task 4.1, Task 1.3
- **推定時間**: 4時間

#### Task 4.3: 共通UIコンポーネント実装

- [ ] Button, Input, Modal, Loading コンポーネント
- [ ] ErrorBoundary コンポーネント
- [ ] Layout コンポーネント（Header, Main, Footer）
- [ ] QRCode表示コンポーネント
- **完了条件**: 共通コンポーネントが再利用可能で統一されたデザイン
- **依存**: Task 4.1
- **推定時間**: 6時間

### Phase 5: コア機能実装

#### Task 5.1: ルーム管理機能の実装

- [ ] ルーム作成画面実装
- [ ] ルーム参加画面実装（URL、コード、QR）
- [ ] ルーム情報表示コンポーネント
- [ ] ルーム設定画面（主催者向け）
- [ ] ルーム終了機能
- **完了条件**: ルームの作成から参加まで完全に動作
- **依存**: Task 4.2, Task 4.3, Task 3.2
- **推定時間**: 8時間

#### Task 5.2: コメント投稿・表示機能

- [ ] コメント投稿フォーム実装
- [ ] コメント一覧表示コンポーネント
- [ ] コメントソート機能（新着順・いいね順）
- [ ] コメント削除機能
- [ ] リアルタイム更新表示
- **完了条件**: コメント機能が完全に動作し、リアルタイム同期される
- **依存**: Task 4.2, Task 4.3, Task 3.3, Task 3.5
- **推定時間**: 10時間

#### Task 5.3: いいね機能の実装

- [ ] いいねボタンコンポーネント
- [ ] いいね数表示・アニメーション
- [ ] いいね制限表示
- [ ] リアルタイムいいね数更新
- **完了条件**: いいね機能が完全に動作し、制限も正しく動作
- **依存**: Task 4.2, Task 4.3, Task 3.4, Task 3.5
- **推定時間**: 4時間

#### Task 5.4: 参加者管理機能の実装

- [ ] ニックネーム設定・検証
- [ ] 参加者一覧表示
- [ ] 参加者数リアルタイム更新
- [ ] 接続状態表示
- **完了条件**: 参加者管理が完全に動作し、リアルタイム更新される
- **依存**: Task 4.2, Task 4.3, Task 3.5
- **推定時間**: 3時間

### Phase 6: 高度な機能実装

#### Task 6.1: エラーハンドリング・UX向上

- [ ] エラー表示コンポーネント
- [ ] Loading状態の改善
- [ ] オフライン対応
- [ ] 再接続機能
- [ ] ユーザーフィードバック（トースト通知）
- **完了条件**: エラー処理が適切で、UXが向上している
- **依存**: Task 4.2, Task 4.3
- **推定時間**: 5時間

#### Task 6.2: レスポンシブデザイン対応

- [ ] モバイル画面レイアウト調整
- [ ] タブレット画面対応
- [ ] タッチ操作最適化
- [ ] PWA対応検討
- **完了条件**: 全デバイスで快適に利用可能
- **依存**: Task 5.1, Task 5.2, Task 5.3
- **推定時間**: 6時間

#### Task 6.3: パフォーマンス最適化

- [ ] React.memoによる再レンダリング最適化
- [ ] 仮想スクロール実装（大量コメント対応）
- [ ] 画像最適化・遅延読み込み
- [ ] バンドルサイズ最適化（code splitting）
- **完了条件**: 100人接続でもスムーズに動作
- **依存**: Task 5.2
- **推定時間**: 4時間

### Phase 7: テスト実装

#### Task 7.1: バックエンド単体テストの実装

- [ ] Room Service テスト実装
- [ ] Comment Service テスト実装
- [ ] Like Service テスト実装
- [ ] WebSocket Handler テスト実装
- [ ] QR Service テスト実装
- **完了条件**: 全Lambda関数のテストカバレッジ80%以上
- **依存**: Phase 3完了
- **推定時間**: 12時間

#### Task 7.2: フロントエンド単体テストの実装

- [ ] コンポーネントテスト実装（Testing Library）
- [ ] カスタムフックテスト実装
- [ ] ユーティリティ関数テスト実装
- [ ] ストアテスト実装
- **完了条件**: フロントエンドテストカバレッジ80%以上
- **依存**: Phase 4, 5完了
- **推定時間**: 10時間

#### Task 7.3: 統合テスト・E2Eテストの実装

- [ ] LocalStack統合テスト実装
- [ ] API統合テスト実装
- [ ] WebSocket統合テスト実装
- [ ] Playwright E2Eテスト実装
- **完了条件**: 主要シナリオのE2Eテストが成功
- **依存**: Phase 3, 5完了
- **推定時間**: 8時間

#### Task 7.4: パフォーマンス・セキュリティテスト

- [ ] 負荷テスト実装（100人同時接続）
- [ ] セキュリティテスト実装（XSS、レート制限）
- [ ] メモリリークテスト
- [ ] ストレステスト実装
- **完了条件**: 全てのパフォーマンス基準をクリア
- **依存**: 全機能実装完了
- **推定時間**: 6時間

### Phase 8: デプロイメント・運用

#### Task 8.1: CI/CDパイプライン構築

- [ ] GitHub Actions ワークフロー設定
- [ ] テスト自動実行設定
- [ ] 段階的デプロイメント（dev→staging→prod）
- [ ] ロールバック機能
- **完了条件**: コミット時の自動テスト・デプロイが動作
- **依存**: Task 7.3
- **推定時間**: 4時間

#### Task 8.2: モニタリング・ログ設定

- [ ] CloudWatch ダッシュボード設定
- [ ] アラート設定（エラー率、レスポンスタイム）
- [ ] ログ収集・分析設定
- [ ] メトリクス設定
- **完了条件**: システムの健全性が監視可能
- **依存**: 全インフラ実装完了
- **推定時間**: 3時間

#### Task 8.3: ドキュメント作成

- [ ] README.md作成（セットアップ手順）
- [ ] API仕様書作成
- [ ] デプロイメントガイド作成
- [ ] トラブルシューティングガイド作成
- **完了条件**: 開発者が独立して開発・運用可能
- **依存**: 全実装完了
- **推定時間**: 4時間

#### Task 8.4: 本番リリース準備

- [ ] 最終動作確認
- [ ] セキュリティチェック
- [ ] パフォーマンス最終確認
- [ ] 本番環境デプロイ
- [ ] リリース後動作確認
- **完了条件**: 本番環境で全機能が正常動作
- **依存**: 全タスク完了
- **推定時間**: 4時間

## 実装順序

### クリティカルパス
1. Phase 1 → Phase 2 → Phase 3 → Phase 5 → Phase 7 → Phase 8

### 並行実行可能
- Task 3.2-3.6 (各Lambda関数) は並行開発可能
- Task 4.1-4.3 (フロントエンド基盤) は Task 3.1 完了後に並行可能
- Task 5.1-5.4 (コア機能) は該当バックエンド完了後に並行可能
- Task 7.1-7.2 (単体テスト) は各実装完了後すぐに並行可能

## リスクと対策

- **WebSocket接続の不安定性**: 再接続機能と段階的テストで対策
- **DynamoDBホットパーティション**: 適切なパーティションキー設計で回避
- **大規模負荷テストの実施困難**: 段階的負荷テストとシミュレーション活用
- **フロントエンドの複雑性増大**: コンポーネント設計の早期確立
- **開発環境の複雑さ**: LocalStackとDockerによる標準化

## 注意事項

- 各タスクはコミット単位で完結させる
- Task完了時は必ずbiome format, biome lintを実行
- テスト実装は機能実装と同時進行
- セキュリティ要件は各実装段階で考慮
- パフォーマンス要件は実装初期から意識

## 実装開始ガイド

1. このタスクリストに従って順次実装を進めてください
2. 各タスクの開始時にTodoWriteでin_progressに更新
3. 完了時はcompletedに更新
4. 問題発生時は速やかに報告してください
5. 依存関係を確認してから次のタスクに進んでください

### 推奨開始順序
1. Task 1.1 (モノレポ構造) → Task 1.2 (開発環境) → Task 1.3 (共通型定義)
2. Task 2.1 (CDK基盤) → Task 2.2 (DynamoDB) → Task 2.3 (API Gateway)
3. Task 3.1 (Lambda基盤) → Task 3.2 (Room Service) と並行して Task 4.1 (React初期化)

最初の1週間で Phase 1-2 の完了、2週目で Phase 3-4、3週目で Phase 5-6、4週目で Phase 7-8 の完了を目標としてください。